<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guess Who - Animal Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
            background: #ffffff;
            color: #111;
            line-height: 1.55;
            padding: 0;
        }
        
        .navbar {
            background: #ffffff;
            color: #111;
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #d1d5db;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .navbar h1 {
            font-size: 1.25rem;
            margin: 0;
            font-weight: 600;
        }
        
        .timer-display {
            font-size: 0.9rem;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
            color: #111;
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 2px;
        }
        
        .timer-display.warning {
            background: #dc2626;
            color: white;
            border-color: #b91c1c;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .main-content {
            padding: 24px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 32px;
            border-radius: 2px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            max-width: 400px;
            width: 90%;
            border: 1px solid #d1d5db;
        }
        
        .modal-content h2 {
            margin-bottom: 16px;
            font-size: 1.3rem;
            color: #111;
        }
        
        .modal-content input {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 2px;
            margin-bottom: 16px;
        }
        
        .modal-content button {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            background: #6b7280;
            color: white;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .modal-content button:hover {
            background: #4b5563;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .game-layout {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 24px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 900px) {
            .game-layout {
                grid-template-columns: 1fr;
            }
        }
        
        .intro {
            margin-bottom: 20px;
            color: #374151;
        }
        
        .appearances {
            background: #f6f8fa;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }
        
        .appearances h2 {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: #111;
        }
        
        .appearances ul {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
            margin: 0;
            padding: 0;
        }
        
        .appearances li {
            color: #374151;
            font-size: 0.95rem;
        }
        
        .score-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .score-label {
            font-size: 0.95rem;
            color: #374151;
        }
        
        .score-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #111;
        }
        
        .game-board {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
        }
        
        .animal-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
        }
        
        .animal-card {
            background: white;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            padding: 6px;
            cursor: pointer;
            transition: all 0.15s;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .animal-card:hover:not(.eliminated) {
            border-color: #9ca3af;
            background: #fafafa;
        }
        
        .animal-card.selected {
            border: 3px solid #fbbf24;
            background: #fffbeb;
        }
        
        .animal-card.eliminated {
            opacity: 0.25;
            pointer-events: none;
            background: #f3f4f6;
        }
        
        .animal-emoji {
            font-size: 1.4em;
            line-height: 1;
        }
        
        .animal-name {
            font-size: 0.55em;
            color: #374151;
            margin-top: 3px;
            font-weight: 500;
            text-align: center;
        }
        
        .controls {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .question-display {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            padding: 16px;
            min-height: 80px;
            font-size: 0.95rem;
            color: #111;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        button {
            padding: 10px 14px;
            font-size: 0.9rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
            font-weight: 500;
            background: white;
            color: #111;
        }
        
        button:hover:not(:disabled) {
            background: #f9fafb;
            border-color: #9ca3af;
        }
        
        button:active:not(:disabled) {
            transform: scale(0.98);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .submit-btn {
            background: #111;
            color: white;
            border-color: #111;
        }
        
        .submit-btn:hover:not(:disabled) {
            background: #374151;
            border-color: #374151;
        }
        
        .feedback {
            background: #f6f8fa;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            padding: 12px;
            font-size: 0.9rem;
            color: #374151;
        }
        
        .feedback.success {
            background: #f0fdf4;
            border-color: #86efac;
            color: #166534;
        }
        
        .feedback.error {
            background: #fef2f2;
            border-color: #fca5a5;
            color: #991b1b;
        }
        
        .estimate-section {
            background: transparent;
            border: none;
            padding: 16px 0;
            margin-bottom: 24px;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 20px;
            align-items: center;
        }
        
        .estimate-text {
            font-size: 1.1rem;
            color: #374151;
            line-height: 1.6;
        }
        
        .estimate-text strong {
            color: #111;
        }
        
        .estimate-text a {
            color: #2563eb;
            text-decoration: none;
        }
        
        .estimate-text a:hover {
            text-decoration: underline;
        }
        
        .estimate-input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .estimate-input-group input {
            width: 140px;
            padding: 10px 14px;
            font-size: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 2px;
            text-align: center;
        }
        
        /* Remove number input arrows */
        .estimate-input-group input::-webkit-outer-spin-button,
        .estimate-input-group input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .estimate-input-group input[type=number] {
            -moz-appearance: textfield;
        }
        
        .estimate-input-group button {
            padding: 10px 18px;
            font-size: 0.95rem;
            background: #6b7280;
            color: white;
            border: none;
            white-space: nowrap;
        }
        
        .estimate-input-group button:hover:not(:disabled) {
            background: #4b5563;
        }
        
        @media (max-width: 900px) {
            .estimate-section {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .estimate-input-group {
                justify-content: flex-start;
            }
        }

        @media (max-width: 900px) {
            .animal-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        @media (max-width: 600px) {
            .animal-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- User ID Modal -->
    <div class="modal active" id="userModal">
        <div class="modal-content">
            <h2>Welcome to Guess Who!</h2>
            <p style="margin-bottom: 16px; color: #374151;">Please enter your number identifier:</p>
            <input type="text" id="userIdInput" placeholder="Enter your number identifier" autofocus>
            <button onclick="startGame()">Start Game</button>
        </div>
    </div>
 

    <!-- Timer Navbar -->
    <div class="navbar">
        <h1>Guess Who â€“ Animal Edition</h1>
        <div class="timer-display" id="timerDisplay">10:00</div>
    </div>
    
    <div class="main-content">
    <div class="container">
    <p>As most of you are familiar with the board game <em>Guess Who</em>, today we're going to explore a slightly modified version of it.</p>

    <p>You will try to guess the animal chosen by asking <strong>YES/NO</strong> questions.</p>

    <p>Be aware that some animals can appear <strong>multiple times</strong>, and you may group several different animals together in one question.</p>
        <br>

        <div class="appearances">
            <h2>There are 32 animals:</h2>
            <ul>
                <li><strong>8</strong> Dogs</li>
                <li><strong>4</strong> Cats</li>
                <li><strong>4</strong> Tigers</li>
                <li><strong>4</strong> Lions</li>
                <li><strong>4</strong> Elephants</li>
                <li><strong>2</strong> Sharks</li>
                <li><strong>2</strong> Zebras</li>
                <li><strong>2</strong> Eagles</li>
                <li><strong>1</strong> Frog</li>
                <li><strong>1</strong> Snake</li>
            </ul>
        </div>

 
        <div class="estimate-section">
            <div class="estimate-text">
                <strong>Estimate the average number of YES/NO questions needed to find the animal, assuming you ask optimally.</strong><br>
                <span style="font-size: 0.85rem;">(Hint: consider animal occurrence probabilities.)</span><br><br>
                <span style="font-size: 0.85rem;">You can play the <strong>game</strong> below to get a better idea. You may need a calculator: <a href="https://www.tcsion.com/OnlineAssessment/ScientificCalculator/Calculator.html#nogo" target="_blank">Scientific Calculator</a></span>
            </div>
            <div class="estimate-input-group">
                <input type="number" id="estimateInput" step="0.01" placeholder="0.00" min="0">
                <button onclick="submitEstimate()">Submit</button>
            </div>
        </div>
  <hr>
        <br>
        <div class="score-section">
            <div class="score-item">
                <span class="score-label">Round:</span>
                <span class="score-value" id="roundCount">0</span>
            </div>
            <div class="score-item">
                <span class="score-label">Questions Asked:</span>
                <span class="score-value" id="score">0</span>
            </div>
        </div>
        
        <div class="game-layout">
            <div class="game-board">
                <div class="animal-grid" id="animalGrid"></div>
            </div>
            
            <div class="controls">
                <div class="question-display" id="questionDisplay">
                    Select animals to ask a question
                </div>
                
                <div class="button-group">
                    <button class="submit-btn" id="submitBtn" disabled>Submit Question</button>
                    <button id="clearBtn">Clear</button>
                    <button id="resetBtn">New Game</button>
                </div>
                
                <div class="feedback" id="feedback">Select one or more animals and click Submit. Select only ONE animal to make your final guess.</div>
            </div>
        </div>
    </div>
    </div>

    <script>
        // Game state variables
        let userId = null;
        let timerInterval = null;
        let timeRemaining = 600; // 10 minutes in seconds
        let roundCount = 0;
        let questionsAsked = [];
        
        const animalDistribution = [
            { name: 'Dog', emoji: 'ðŸ¶', count: 8 },
            { name: 'Cat', emoji: 'ðŸ±', count: 4 },
            { name: 'Tiger', emoji: 'ðŸ¯', count: 4 },
            { name: 'Lion', emoji: 'ðŸ¦', count: 4 },
            { name: 'Elephant', emoji: 'ðŸ˜', count: 4 },
            { name: 'Shark', emoji: 'ðŸ¦ˆ', count: 2 },
            { name: 'Zebra', emoji: 'ðŸ¦“', count: 2 },
            { name: 'Eagle', emoji: 'ðŸ¦…', count: 2 },
            { name: 'Frog', emoji: 'ðŸ¸', count: 1 },
            { name: 'Snake', emoji: 'ðŸ', count: 1 }
        ];

        let animals = [];
        let targetAnimal = null;
        let selectedAnimals = new Set();
        let eliminatedAnimals = new Set();
        let questionCount = 0;

        // Start game after user enters ID
        function startGame() {
            const input = document.getElementById('userIdInput');
            if (!input.value.trim()) {
                alert('Please enter your number identifier');
                return;
            }
            userId = input.value.trim();
            document.getElementById('userModal').classList.remove('active');
            startTimer();
            initGame();
        }
        
        // Timer functions
        function startTimer() {
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 60) {
                    document.getElementById('timerDisplay').classList.add('warning');
                }
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function endGame() {
            alert('Good Job, now return on Moodle!');
            clearInterval(timerInterval);
        }
        
        // Send data to Google Apps Script
        async function sendRoundData() {
            const url = 'https://script.google.com/macros/s/AKfycbxWUOZIgDQuuQecvT9oCJFtDaJshExJ0Siv7KWcylwIxCnd3Rr4MZa0tfpmO08gflY/exec?sheet=Rounds';
            
            const data = {
                user: userId,
                num_questions: questionCount,
                questions: questionsAsked.join(';')
            };
            
            try {
                await fetch(url, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                console.log('Round data sent successfully:', data);
            } catch (error) {
                console.error('Error sending round data:', error);
            }
        }
        
        // Submit estimate to Google Apps Script
        async function submitEstimate() {
            const input = document.getElementById('estimateInput');
            const value = input.value.trim();
            
            if (!value || isNaN(value) || parseFloat(value) < 0) {
                alert('Please enter a valid number');
                return;
            }
            
            const url = 'https://script.google.com/macros/s/AKfycbxWUOZIgDQuuQecvT9oCJFtDaJshExJ0Siv7KWcylwIxCnd3Rr4MZa0tfpmO08gflY/exec?sheet=Submissions';
            
            const data = {
                user: userId,
                result: value
            };
            
            try {
                await fetch(url, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                alert('Estimate submitted successfully!');
                input.value = '';
                console.log('Estimate sent successfully:', data);
            } catch (error) {
                console.error('Error sending estimate:', error);
                alert('Error submitting estimate. Please try again.');
            }
        }

        function createAnimalBoard() {
            animals = [];
            animalDistribution.forEach(animal => {
                for (let i = 0; i < animal.count; i++) {
                    animals.push({ ...animal });
                }
            });
            // Shuffle the animals array
            for (let i = animals.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [animals[i], animals[j]] = [animals[j], animals[i]];
            }
        }

        function initGame() {
            createAnimalBoard();
            targetAnimal = animals[Math.floor(Math.random() * animals.length)];
            selectedAnimals.clear();
            eliminatedAnimals.clear();
            questionCount = 0;
            questionsAsked = [];
            updateScore();
            updateRoundCount();
            renderBoard();
            updateQuestionDisplay();
            updateFeedback('Game started! Try to find the animal by asking YES/NO questions.', '');
            console.log('Target animal:', targetAnimal.name); // For debugging
        }

        function updateRoundCount() {
            document.getElementById('roundCount').textContent = roundCount;
        }

        function renderBoard() {
            const grid = document.getElementById('animalGrid');
            grid.innerHTML = '';
            
            animals.forEach((animal, index) => {
                const card = document.createElement('div');
                card.className = 'animal-card';
                card.dataset.index = index;
                
                if (eliminatedAnimals.has(index)) {
                    card.classList.add('eliminated');
                }
                
                if (selectedAnimals.has(index)) {
                    card.classList.add('selected');
                }
                
                card.innerHTML = `
                    <div class="animal-emoji">${animal.emoji}</div>
                    <div class="animal-name">${animal.name}</div>
                `;
                
                card.addEventListener('click', () => toggleAnimal(index));
                grid.appendChild(card);
            });
        }

        function toggleAnimal(index) {
            if (eliminatedAnimals.has(index)) return;
            
            const clickedAnimal = animals[index];
            const animalType = clickedAnimal.name;
            
            // Find all indices of this animal type
            const sameTypeIndices = [];
            animals.forEach((animal, idx) => {
                if (animal.name === animalType && !eliminatedAnimals.has(idx)) {
                    sameTypeIndices.push(idx);
                }
            });
            
            // Check if any of this type are currently selected
            const anySelected = sameTypeIndices.some(idx => selectedAnimals.has(idx));
            
            if (anySelected) {
                // Deselect all of this type
                sameTypeIndices.forEach(idx => selectedAnimals.delete(idx));
            } else {
                // Select all of this type
                sameTypeIndices.forEach(idx => selectedAnimals.add(idx));
            }
            
            renderBoard();
            updateQuestionDisplay();
            document.getElementById('submitBtn').disabled = selectedAnimals.size === 0;
        }

        function updateQuestionDisplay() {
            const display = document.getElementById('questionDisplay');
            
            if (selectedAnimals.size === 0) {
                display.textContent = 'Select animals to ask a question';
            } else {
                const names = Array.from(selectedAnimals).map(i => animals[i].name);
                const uniqueNames = [...new Set(names)];
                display.textContent = `Is it ${uniqueNames.join(' OR ')}?`;
            }
        }

        function updateScore() {
            document.getElementById('score').textContent = questionCount;
        }

        function updateFeedback(message, type = '') {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = 'feedback' + (type ? ' ' + type : '');
        }

        function submitQuestion() {
            if (selectedAnimals.size === 0) return;
            
            questionCount++;
            updateScore();
            
            // Get unique animal types selected
            const selectedNames = Array.from(selectedAnimals).map(i => animals[i].name);
            const uniqueNames = [...new Set(selectedNames)];
            
            // Build the question string
            const questionString = `Is it ${uniqueNames.join(' OR ')}?`;
            questionsAsked.push(questionString);
            
            // Check if it's a final guess (only one animal type selected)
            if (uniqueNames.length === 1) {
                const guessedType = uniqueNames[0];
                
                if (guessedType === targetAnimal.name) {
                    updateFeedback(`Correct! It was ${targetAnimal.name}! You found it in ${questionCount} questions.`, 'success');
                    
                    // Send round data before starting new round
                    sendRoundData();
                    
                    // Increment round and start new round
                    roundCount++;
                    
                    setTimeout(() => {
                        initGame();
                    }, 1500);
                } else {
                    updateFeedback(`No, it's not ${guessedType}. Keep trying!`, 'error');
                    // Eliminate all cards of the wrong type
                    selectedAnimals.forEach(index => eliminatedAnimals.add(index));
                }
            } else {
                // Multiple animal types selected - answer YES/NO
                const isTargetIncluded = uniqueNames.includes(targetAnimal.name);
                
                if (isTargetIncluded) {
                    updateFeedback(`YES, it is one of: ${uniqueNames.join(', ')}.`, 'success');
                } else {
                    updateFeedback(`NO, it's not any of: ${uniqueNames.join(', ')}.`, 'error');
                    // Eliminate all selected cards
                    selectedAnimals.forEach(index => eliminatedAnimals.add(index));
                }
            }
            
            selectedAnimals.clear();
            renderBoard();
            updateQuestionDisplay();
            document.getElementById('submitBtn').disabled = true;
        }

        function clearSelection() {
            selectedAnimals.clear();
            renderBoard();
            updateQuestionDisplay();
            document.getElementById('submitBtn').disabled = true;
        }

        document.getElementById('submitBtn').addEventListener('click', submitQuestion);
        document.getElementById('clearBtn').addEventListener('click', clearSelection);
        document.getElementById('resetBtn').addEventListener('click', initGame);

        // Don't auto-start the game - wait for user ID input
    </script>
</body>
</html>